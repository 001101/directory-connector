<div class="card mb-3">
    <h3 class="card-header">{{'sync' | i18n}}</h3>
    <div class="card-body">
        <p>
            Last group sync:
            <span *ngIf="!lastGroupSync">-</span>
            {{lastGroupSync | date:'medium'}}
            <br /> Last user sync:
            <span *ngIf="!lastUserSync">-</span>
            {{lastUserSync | date:'medium'}}
        </p>
        <p>
            Sync status:
            <strong *ngIf="syncRunning" class="text-success">Running</strong>
            <strong *ngIf="!syncRunning" class="text-danger">Stopped</strong>
        </p>
        <button #startBtn (click)="start()" [appApiAction]="startPromise" class="btn btn-primary" [disabled]="startBtn.loading">
            <i class="fa fa-play fa-fw" [hidden]="startBtn.loading"></i>
            <i class="fa fa-spinner fa-fw fa-spin" [hidden]="!startBtn.loading"></i>
            Start Sync
        </button>
        <button (click)="stop()" class="btn btn-primary">
            <i class="fa fa-stop fa-fw"></i>
            Stop Sync
        </button>
        <button #syncBtn (click)="sync()" [appApiAction]="syncPromise" class="btn btn-primary" [disabled]="syncBtn.loading">
            <i class="fa fa-refresh fa-fw" [ngClass]="{'fa-spin': syncBtn.loading}"></i>
            Sync Now
        </button>
    </div>
</div>
<div class="card">
    <h3 class="card-header">Testing</h3>
    <div class="card-body">
        <p>You can run tests to see how your directory and sync settings are working. Tests will not sync to your Bitwarden organization.</p>
        <button #simBtn (click)="simulate()" [appApiAction]="simPromise" class="btn btn-primary" [disabled]="simBtn.loading">
            <i class="fa fa-spinner fa-fw fa-spin" [hidden]="!simBtn.loading"></i>
            <i class="fa fa-bug fa-fw" [hidden]="simBtn.loading"></i>
            Test Now
        </button>
        <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" id="simSinceLast" [(ngModel)]="simSinceLast">
            <label class="form-check-label" for="simSinceLast">Since the last successful sync</label>
        </div>
        <ng-container *ngIf="!simBtn.loading && (simUsers || simGroups)">
            <hr />
            <div class="row">
                <div class="col-lg">
                    <h4>Users</h4>
                    <ul class="fa-ul testing-list" *ngIf="simEnabledUsers && simEnabledUsers.length">
                        <li *ngFor="let u of simEnabledUsers" title="{{u.referenceId}}">
                            <i class="fa-li fa fa-user"></i>
                            {{u.displayName}}
                        </li>
                    </ul>
                    <p *ngIf="!simEnabledUsers || !simEnabledUsers.length">No users to list.</p>
                    <h4>Disabled Users</h4>
                    <ul class="fa-ul testing-list" *ngIf="simDisabledUsers && simDisabledUsers.length">
                        <li *ngFor="let u of simDisabledUsers" title="{{u.referenceId}}">
                            <i class="fa-li fa fa-user"></i>
                            {{u.displayName}}
                        </li>
                    </ul>
                    <p *ngIf="!simDisabledUsers || !simDisabledUsers.length">No users to list.</p>
                    <h4>Deleted Users</h4>
                    <ul class="fa-ul testing-list" *ngIf="simDeletedUsers && simDeletedUsers.length">
                        <li *ngFor="let u of simDeletedUsers" title="{{u.referenceId}}">
                            <i class="fa-li fa fa-user"></i>
                            {{u.displayName}}
                        </li>
                    </ul>
                    <p *ngIf="!simDeletedUsers || !simDeletedUsers.length">No users to list.</p>
                </div>
                <div class="col-lg">
                    <h4>Groups</h4>
                    <ul class="fa-ul testing-list" *ngIf="simGroups && simGroups.length">
                        <li *ngFor="let g of simGroups" title="{{g.referenceId}}">
                            <i class="fa-li fa fa-sitemap"></i>
                            {{g.displayName}}
                            <ul class="small" *ngIf="g.users && g.users.length">
                                <li *ngFor="let u of g.users" title="{{u.referenceId}}">{{u.displayName}}</li>
                            </ul>
                        </li>
                    </ul>
                    <p *ngIf="!simGroups || !simGroups.length">No groups to list.</p>
                </div>
            </div>
        </ng-container>
    </div>
</div>
